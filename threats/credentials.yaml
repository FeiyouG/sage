# Credential exposure threat patterns for Sage
# Author: Gen Digital Inc.
# License: DRL-1.1 (see threats/LICENSE)

# --- Known API key prefixes ---
- id: "CLT-CRED-001"
  category: secrets
  severity: critical
  confidence: 0.80
  action: block
  pattern: "(sk-[a-zA-Z0-9_-]{20,}|sk-proj-[a-zA-Z0-9_-]{20,}|AKIA[0-9A-Z]{16}|AIza[0-9A-Za-z_-]{35}|ghp_[0-9a-zA-Z]{36}|gho_[0-9a-zA-Z]{36}|glpat-[0-9a-zA-Z_-]{20,}|xox[baprs]-[0-9a-zA-Z-]+)"
  match_on: [command, content]
  title: "Known API key prefix detected"
  expires_at: null
  revoked: false

# --- Export of credential env vars ---
- id: "CLT-CRED-002"
  category: secrets
  severity: high
  confidence: 0.80
  action: require_approval
  pattern: "\\bexport\\s+[A-Z_]*(API_KEY|SECRET|TOKEN|PASSWORD|CREDENTIAL|AUTH)[A-Z_]*="
  match_on: command
  title: "Export of environment variable with credential keyword"
  expires_at: null
  revoked: false

# --- .env file writes ---
- id: "CLT-CRED-003"
  category: secrets
  severity: high
  confidence: 0.80
  action: require_approval
  pattern: "(>>|>)\\s*\\.env(\\.local|\\.production|\\.staging|\\.development)?\\b"
  match_on: command
  title: "Write/append to .env file (potential credential exposure)"
  expires_at: null
  revoked: false

# --- Reading credential files ---
- id: "CLT-CRED-004"
  category: secrets
  severity: high
  confidence: 0.80
  action: require_approval
  pattern: "\\b(cat|less|more|head|tail)\\s+.*(\\.(env|env\\.local|env\\.production)|credentials|\\.aws/credentials|\\.ssh/id_rsa|\\.ssh/id_ed25519|\\.netrc|\\.pgpass)"
  match_on: command
  title: "Reading credential or secret file"
  expires_at: null
  revoked: false

# --- Plaintext credential assignment ---
- id: "CLT-CRED-005"
  category: secrets
  severity: high
  confidence: 0.85
  action: require_approval
  pattern: "\\b(PASSWORD|API_SECRET|SECRET_KEY|PRIVATE_KEY|DB_PASSWORD|MYSQL_PASSWORD|POSTGRES_PASSWORD)=[\"']?[^\\s\"']{8,}"
  match_on: [command, content]
  title: "Plaintext credential assignment detected"
  expires_at: null
  revoked: false

# --- Long-form API key patterns ---
- id: "CLT-CRED-006"
  category: secrets
  severity: critical
  confidence: 0.92
  action: block
  pattern: "(github_pat_[0-9a-zA-Z_]{22,}|SG\\.[0-9a-zA-Z_-]{22,}\\.[0-9a-zA-Z_-]{22,}|pk_live_[0-9a-zA-Z]{24,}|sk_live_[0-9a-zA-Z]{24,}|rk_live_[0-9a-zA-Z]{24,})"
  match_on: [command, content]
  title: "Long-form API key pattern detected (GitHub PAT, SendGrid, Stripe)"
  expires_at: null
  revoked: false
